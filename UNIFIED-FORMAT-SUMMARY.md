# BRAS Map çµ±ä¸€æ ¼å¼ - å¯¦æ–½æ‘˜è¦

## ğŸ¯ æ ¼å¼çµ±ä¸€å®Œæˆ

æ‰€æœ‰ BRAS è¨­å‚™ï¼ˆE320/ACX/MX960/MX240ï¼‰ç¾åœ¨ä½¿ç”¨**çµ±ä¸€çš„ E320 Map File æ ¼å¼**ã€‚

## ğŸ“‹ çµ±ä¸€æ ¼å¼å®šç¾©

### æ ¼å¼æ¨™æº–
```
ä½¿ç”¨è€…ä»£ç¢¼,ä¸‹è¼‰é€Ÿç‡(Kbps),ä¸Šå‚³é€Ÿç‡(Kbps),ifindex,VLAN
```

### æª”æ¡ˆå‘½å
```
map_{BRAS_IP}_{slot}_{port}.txt
```

**ç¯„ä¾‹**ï¼š
- `map_61.64.191.1_1_2.txt` (E320: slot=1, port=2)
- `map_10.1.1.1_0_0.txt` (ACX: slot=0, port=0)
- `map_10.1.1.2_1_0.txt` (MX960: slot=1, port=0)

## ğŸ—‚ï¸ æ–°çš„æª”æ¡ˆæ¶æ§‹

### è¨­å‚™æ¸…å–®ï¼šBRAS-Devices.txt
```
# æ ¼å¼: BRAS_IP,è¨­å‚™é¡å‹,ä¸»æ©Ÿåç¨±,å€åŸŸ,é »å¯¬ä¸Šé™(Mbps)
61.64.191.1,E320,TC-BRAS-OLD-01,å°ä¸­,880
10.1.1.1,ACX,KH-ACX-01,é«˜é›„,1000
10.1.1.2,MX960,TP-MX960-01,å°åŒ—,10000
10.1.1.3,MX240,TC-MX240-01,å°ä¸­äº¤å¿ƒ,10000
```

### Map Files ç¯„ä¾‹

#### E320
```
# map_61.64.191.1_1_2.txt
0989703334,35840,6144,587247394,3490
0981234567,102400,40960,587247395,3491
```

#### ACX7024
```
# map_10.1.1.1_0_0.txt
fixedip001,51200,20480,1024,100
fixedip002,102400,40960,1025,101
```

#### MX960
```
# map_10.1.1.2_1_0.txt
user01@isp.com,102400,40960,2048,200
user02@isp.com,51200,20480,2049,201
```

#### MX240
```
# map_10.1.1.3_1_0.txt
pppoe_user1,204800,102400,3072,300
pppoe_user2,102400,40960,3073,301
```

## ğŸ“¦ æ–°å¢äº¤ä»˜æª”æ¡ˆ

### æ–‡æª”ï¼ˆ1 å€‹ï¼‰
- **[UNIFIED-MAP-FORMAT.md](computer:///mnt/user-data/outputs/UNIFIED-MAP-FORMAT.md)** â­â­â­ - å®Œæ•´æ ¼å¼è¦ç¯„

### ç¨‹å¼ï¼ˆ2 å€‹ï¼‰
- **[unified_map_reader.py](computer:///mnt/user-data/outputs/unified_map_reader.py)** â­â­â­ - çµ±ä¸€è®€å–å™¨
- **[convert_bras_map.py](computer:///mnt/user-data/outputs/convert_bras_map.py)** â­â­ - æ ¼å¼è½‰æ›å·¥å…·

### é…ç½®ç¯„ä¾‹ï¼ˆ2 å€‹ï¼‰
- **[BRAS-Devices.txt](computer:///mnt/user-data/outputs/BRAS-Devices.txt)** â­â­â­ - è¨­å‚™æ¸…å–®ç¯„ä¾‹
- **examples/maps_unified/** â­â­ - Map File ç¯„ä¾‹

## âœ… çµ±ä¸€æ ¼å¼çš„å„ªé»

### 1. æ ¼å¼çµ±ä¸€
æ‰€æœ‰è¨­å‚™ä½¿ç”¨å®Œå…¨ç›¸åŒçš„ 5 æ¬„ä½æ ¼å¼ï¼Œç„¡éœ€é‡å°ä¸åŒè¨­å‚™ç¶­è­·ä¸åŒæ ¼å¼ã€‚

### 2. E320 å®Œå…¨ç›¸å®¹
100% ç›¸å®¹ç¾æœ‰ E320 Map File æ ¼å¼ï¼Œç„¡éœ€ä¿®æ”¹ä»»ä½•ç¾æœ‰æª”æ¡ˆã€‚

### 3. ç°¡åŒ–ç¶­è­·
- å–®ä¸€æ ¼å¼å®šç¾©
- çµ±ä¸€çš„è®€å–å™¨
- çµ±ä¸€çš„é©—è­‰å·¥å…·

### 4. è‡ªå‹•è­˜åˆ¥
é€éæª”åè‡ªå‹•è­˜åˆ¥ï¼š
- BRAS IP
- æ’æ§½ (slot)
- åŸ è™Ÿ (port)

### 5. æ˜“æ–¼æ“´å……
æ–°å¢è¨­å‚™åªéœ€ï¼š
1. åœ¨ BRAS-Devices.txt åŠ å…¥è¨­å‚™è³‡è¨Š
2. å‰µå»ºå°æ‡‰çš„ map_{IP}_{slot}_{port}.txt

## ğŸ”„ å¾èˆŠæ ¼å¼é·ç§»

### èˆŠæ ¼å¼ï¼ˆè¤‡é›œçš„ 13 æ¬„ä½ï¼‰
```
bras_hostname,device_type,bras_ip,circuit_id,pvc,trunk_number,phone,area,interface,slot,port,bandwidth,vlan_count
```

### æ–°æ ¼å¼ï¼ˆç°¡å–®çš„ 5 æ¬„ä½ï¼‰
```
ä½¿ç”¨è€…ä»£ç¢¼,ä¸‹è¼‰é€Ÿç‡,ä¸Šå‚³é€Ÿç‡,ifindex,VLAN
```

### è½‰æ›å·¥å…·
```bash
python3 convert_bras_map.py \
  --input old-BRAS-Map.txt \
  --output-dir maps/
```

é€™æœƒç”¢ç”Ÿï¼š
- `BRAS-Devices.txt` - è¨­å‚™æ¸…å–®
- `maps/map_*.txt` - å„è¨­å‚™çš„ Map Files

## ğŸš€ ä½¿ç”¨æ–°æ ¼å¼

### 1. æŸ¥çœ‹æ‰€æœ‰è¨­å‚™
```bash
python3 unified_map_reader.py --statistics
```

è¼¸å‡ºï¼š
```
BRAS è¨­å‚™çµ±è¨ˆ
ç¸½è¨­å‚™æ•¸: 7

E320:
  - 61.64.191.1     TC-BRAS-OLD-01       å°ä¸­           880 Mbps
  - 127.0.0.1       TEST-E320            æ¸¬è©¦           880 Mbps
ACX:
  - 10.1.1.1        KH-ACX-01            é«˜é›„          1000 Mbps
MX960:
  - 10.1.1.2        TP-MX960-01          å°åŒ—         10000 Mbps
MX240:
  - 10.1.1.3        TC-MX240-01          å°ä¸­äº¤å¿ƒ       10000 Mbps

æ‰¾åˆ° 4 å€‹ Map File
  - 127.0.0.1       slot=1  port=2  E320    1 users
  - 10.1.1.1        slot=0  port=0  ACX     3 users
  - 10.1.1.2        slot=1  port=0  MX960   3 users
  - 10.1.1.3        slot=1  port=0  MX240   3 users
```

### 2. è®€å–å–®ä¸€ Map File
```bash
python3 unified_map_reader.py \
  --bras-ip 127.0.0.1 \
  --slot 1 \
  --port 2
```

è¼¸å‡ºï¼š
```
è¼‰å…¥ Map File: 127.0.0.1 slot=1 port=2
è¨­å‚™é¡å‹: E320
ä¸»æ©Ÿåç¨±: TEST-E320
å€åŸŸ: æ¸¬è©¦
é »å¯¬ä¸Šé™: 880 Mbps

ä½¿ç”¨è€…æ•¸: 1
é€Ÿç‡æ–¹æ¡ˆ: 1 ç¨®
  35840_6144 (35M/6M): 1 ç”¨æˆ¶

å‰ 5 å€‹ä½¿ç”¨è€…:
  0989703334      35840_6144      ifindex= 587247394 vlan=3490
```

### 3. é©—è­‰æ ¼å¼
```bash
python3 unified_map_reader.py \
  --bras-ip 127.0.0.1 \
  --slot 1 \
  --port 2 \
  --validate
```

è¼¸å‡ºï¼š
```
é©—è­‰ Map File:
âœ“ æ ¼å¼æ­£ç¢º
```

## ğŸ“‚ ç›®éŒ„çµæ§‹

```
/opt/rrdw/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ BRAS-Devices.txt              # è¨­å‚™æ¸…å–®
â”‚   â””â”€â”€ maps/                         # Map Files
â”‚       â”œâ”€â”€ map_61.64.191.1_1_2.txt   # E320 Map File
â”‚       â”œâ”€â”€ map_10.1.1.1_0_0.txt      # ACX Map File
â”‚       â”œâ”€â”€ map_10.1.1.2_1_0.txt      # MX960 Map File
â”‚       â””â”€â”€ map_10.1.1.3_1_0.txt      # MX240 Map File
â”‚
â”œâ”€â”€ unified_map_reader.py             # çµ±ä¸€è®€å–å™¨ â­â­â­
â”œâ”€â”€ convert_bras_map.py               # æ ¼å¼è½‰æ›å·¥å…· â­â­
â””â”€â”€ ...
```

## ğŸ”§ æ”¶é›†å™¨æ•´åˆ

æ‰€æœ‰æ”¶é›†å™¨ç¾åœ¨ä½¿ç”¨çµ±ä¸€çš„è®€å–å™¨ï¼š

```python
from unified_map_reader import UnifiedMapReader, MapUser

# åˆå§‹åŒ–è®€å–å™¨
reader = UnifiedMapReader("config/maps", "config/BRAS-Devices.txt")

# è¼‰å…¥ Map Fileï¼ˆæ‰€æœ‰è¨­å‚™çµ±ä¸€æ ¼å¼ï¼‰
users = reader.load_map_file(bras_ip, slot, port)

# å–å¾—è¨­å‚™è³‡è¨Š
device = reader.get_device_info(bras_ip)

# ä¾é€Ÿç‡åˆ†çµ„
speed_groups = reader.get_users_by_speed(users)
```

## ğŸ“Š æ¸¬è©¦çµæœ

### E320 è¨­å‚™æ¸¬è©¦
```
æ¸¬è©¦ IP: 127.0.0.1
Slot: 1, Port: 2
âœ“ è¼‰å…¥æˆåŠŸ: 1 å€‹ä½¿ç”¨è€…
âœ“ é€Ÿç‡æ–¹æ¡ˆ: 35840_6144 (35M/6M)
âœ“ ifindex: 587247394
âœ“ VLAN: 3490
âœ“ æ ¼å¼é©—è­‰é€šé
```

### å¤šè¨­å‚™æ¸¬è©¦
```
âœ“ E320: 1 å€‹ Map File, 1 ä½¿ç”¨è€…
âœ“ ACX: 1 å€‹ Map File, 3 ä½¿ç”¨è€…
âœ“ MX960: 1 å€‹ Map File, 3 ä½¿ç”¨è€…
âœ“ MX240: 1 å€‹ Map File, 3 ä½¿ç”¨è€…
```

## ğŸ’¡ å¯¦æ–½å»ºè­°

### éšæ®µ 1: æº–å‚™ï¼ˆ1 å¤©ï¼‰
1. å‰µå»º `BRAS-Devices.txt`
2. åˆ—å‡ºæ‰€æœ‰ BRAS è¨­å‚™è³‡è¨Š

### éšæ®µ 2: E320 è¨­å‚™ï¼ˆç«‹å³ï¼‰
1. æª¢æŸ¥ç¾æœ‰ E320 Map Files
2. ç¢ºèªæª”åç¬¦åˆæ–°æ ¼å¼ï¼š`map_{IP}_{slot}_{port}.txt`
3. æ ¼å¼å·²ç¶“ç¬¦åˆï¼Œç„¡éœ€ä¿®æ”¹å…§å®¹

### éšæ®µ 3: ACX/MX è¨­å‚™ï¼ˆ1-2 å¤©ï¼‰
1. ç‚ºæ¯å€‹ ACX/MX è¨­å‚™å‰µå»º Map File
2. æ ¼å¼ï¼š`ä½¿ç”¨è€…ä»£ç¢¼,ä¸‹è¼‰é€Ÿç‡,ä¸Šå‚³é€Ÿç‡,ifindex,VLAN`
3. é€é SNMP Walk æˆ– RADIUS å–å¾—è³‡æ–™

### éšæ®µ 4: é©—è­‰ï¼ˆåŠå¤©ï¼‰
1. åŸ·è¡Œ `python3 unified_map_reader.py --statistics`
2. é©—è­‰æ‰€æœ‰ Map Files
3. æ¸¬è©¦è®€å–åŠŸèƒ½

### éšæ®µ 5: æ•´åˆï¼ˆ1 å¤©ï¼‰
1. æ›´æ–°æ”¶é›†å™¨ä½¿ç”¨çµ±ä¸€è®€å–å™¨
2. æ¸¬è©¦æ”¶é›†åŠŸèƒ½
3. éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ

## ğŸ¯ é—œéµå·®ç•°

### åŸæœ‰æ–¹å¼
- âŒ è¤‡é›œçš„ 13 æ¬„ä½ BRAS-Map.txt
- âŒ éœ€è¦é‡å°ä¸åŒè¨­å‚™ç‰¹æ®Šè™•ç†
- âŒ æ ¼å¼ä¸ä¸€è‡´

### çµ±ä¸€æ–¹å¼
- âœ… ç°¡å–®çš„ 5 æ¬„ä½ Map File
- âœ… æ‰€æœ‰è¨­å‚™ä½¿ç”¨ç›¸åŒæ ¼å¼
- âœ… 100% E320 ç›¸å®¹
- âœ… è‡ªå‹•è¨­å‚™è­˜åˆ¥

## ğŸ“ˆ ç³»çµ±æ”¹é€²

### ç°¡åŒ–ç¨‹åº¦
- æ ¼å¼æ¬„ä½ï¼š13 â†’ 5 (æ¸›å°‘ 62%)
- æª”æ¡ˆé¡å‹ï¼šå¤šç¨® â†’ 1 ç¨® (çµ±ä¸€)
- è®€å–å™¨ï¼š4 å€‹ â†’ 1 å€‹ (çµ±ä¸€)

### ç¶­è­·æˆæœ¬
- æ ¼å¼ç¶­è­·ï¼šè¤‡é›œ â†’ ç°¡å–®
- æ–°å¢è¨­å‚™ï¼šéœ€ä¿®æ”¹ç¨‹å¼ â†’ åªéœ€åŠ  Map File
- é™¤éŒ¯é›£åº¦ï¼šé«˜ â†’ ä½

## âœ… é©—æ”¶æ¨™æº–

- [x] æ ¼å¼å®šç¾©æ¸…æ™°
- [x] çµ±ä¸€è®€å–å™¨å®Œæˆ
- [x] æ ¼å¼è½‰æ›å·¥å…·å®Œæˆ
- [x] E320 å®Œå…¨ç›¸å®¹
- [x] ç¯„ä¾‹æª”æ¡ˆé½Šå…¨
- [x] æ¸¬è©¦é©—è­‰é€šé
- [x] æ–‡æª”å®Œæ•´

## ğŸ‰ ç¸½çµ

**BRAS Map å·²æˆåŠŸçµ±ä¸€ç‚º E320 æ ¼å¼ï¼**

âœ… æ‰€æœ‰è¨­å‚™ä½¿ç”¨ç›¸åŒçš„ 5 æ¬„ä½æ ¼å¼  
âœ… 100% ç›¸å®¹ç¾æœ‰ E320 ç³»çµ±  
âœ… å¤§å¹…ç°¡åŒ–ç¶­è­·å·¥ä½œ  
âœ… å®Œæ•´çš„å·¥å…·æ”¯æ´  
âœ… è©³ç´°çš„æ–‡æª”èªªæ˜  

**ç³»çµ±æ›´ç°¡å–®ã€æ›´çµ±ä¸€ã€æ›´æ˜“ç¶­è­·ï¼**

---

**ç›¸é—œæ–‡æª”**ï¼š
- [UNIFIED-MAP-FORMAT.md](computer:///mnt/user-data/outputs/UNIFIED-MAP-FORMAT.md) - å®Œæ•´æ ¼å¼è¦ç¯„
- [E320-Integration-Guide.md](computer:///mnt/user-data/outputs/E320-Integration-Guide.md) - E320 æ•´åˆæŒ‡å—
- [COMPLETION-SUMMARY.md](computer:///mnt/user-data/outputs/COMPLETION-SUMMARY.md) - å°ˆæ¡ˆå®Œæˆæ‘˜è¦

**ç¨‹å¼æª”æ¡ˆ**ï¼š
- [unified_map_reader.py](computer:///mnt/user-data/outputs/unified_map_reader.py) - çµ±ä¸€è®€å–å™¨
- [convert_bras_map.py](computer:///mnt/user-data/outputs/convert_bras_map.py) - æ ¼å¼è½‰æ›å·¥å…·

**é…ç½®ç¯„ä¾‹**ï¼š
- [BRAS-Devices.txt](computer:///mnt/user-data/outputs/BRAS-Devices.txt) - è¨­å‚™æ¸…å–®
- examples/maps_unified/ - Map File ç¯„ä¾‹
